// Generated by CoffeeScript 1.8.0

/* global google */
(function($) {
  var add_marker, center_map, render_map;
  render_map = function($el) {
    var $markers, args, map;
    $markers = $el.find('.marker');
    args = {
      zoom: 16,
      center: new google.maps.LatLng(0, 0),
      mapTypeId: google.maps.MapTypeId.ROADMAP
    };
    map = new google.maps.Map($el[0], args);
    map.markers = [];
    $markers.each(function() {
      add_marker($(this), map);
    });
    center_map(map);
  };
  add_marker = function($marker, map) {
    var infowindow, latlng, marker;
    latlng = new google.maps.LatLng($marker.attr('data-lat'), $marker.attr('data-lng'));
    marker = new google.maps.Marker({
      position: latlng,
      map: map
    });
    map.markers.push(marker);
    if ($marker.html()) {
      infowindow = new google.maps.InfoWindow({
        content: $marker.html()
      });
      google.maps.event.addListener(marker, 'click', function() {
        infowindow.open(map, marker);
      });
    }
  };
  center_map = function(map) {
    var bounds;
    bounds = new google.maps.LatLngBounds();
    $.each(map.markers, function(i, marker) {
      var latlng;
      latlng = new google.maps.LatLng(marker.position.lat(), marker.position.lng());
      bounds.extend(latlng);
    });
    if (map.markers.length === 1) {
      map.setCenter(bounds.getCenter());
      map.setZoom(16);
    } else {
      map.fitBounds(bounds);
    }
  };
  $(document).ready(function() {
    $('.acf-map').each(function() {
      render_map($(this));
    });
  });
})(jQuery);
